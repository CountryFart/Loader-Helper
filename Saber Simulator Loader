--[[
Plz no skid, :(                                                                                                                                              
                                                                                                                                              
RRRRRRRRRRRRRRRRR                     llllllllllllll                    222222222222222    MMMMMMMM               MMMMMMMM                    
R::::::::::::::::R                    l:::::ll:::::l                   2:::::::::::::::22  M:::::::M             M:::::::M                    
R::::::RRRRRR:::::R                   l:::::ll:::::l                   2::::::222222:::::2 M::::::::M           M::::::::M                    
RR:::::R     R:::::R                  l:::::ll:::::l                   2222222     2:::::2 M:::::::::M         M:::::::::M                    
  R::::R     R:::::R  aaaaaaaaaaaaa    l::::l l::::lyyyyyyy           yyyyyyy      2:::::2 M::::::::::M       M::::::::::M    eeeeeeeeeeee    
  R::::R     R:::::R  a::::::::::::a   l::::l l::::l y:::::y         y:::::y       2:::::2 M:::::::::::M     M:::::::::::M  ee::::::::::::ee  
  R::::RRRRRR:::::R   aaaaaaaaa:::::a  l::::l l::::l  y:::::y       y:::::y     2222::::2  M:::::::M::::M   M::::M:::::::M e::::::eeeee:::::ee
  R:::::::::::::RR             a::::a  l::::l l::::l   y:::::y     y:::::y 22222::::::22   M::::::M M::::M M::::M M::::::Me::::::e     e:::::e
  R::::RRRRRR:::::R     aaaaaaa:::::a  l::::l l::::l    y:::::y   y:::::y22::::::::222     M::::::M  M::::M::::M  M::::::Me:::::::eeeee::::::e
  R::::R     R:::::R  aa::::::::::::a  l::::l l::::l     y:::::y y:::::y2:::::22222        M::::::M   M:::::::M   M::::::Me:::::::::::::::::e 
  R::::R     R:::::R a::::aaaa::::::a  l::::l l::::l      y:::::y:::::y2:::::2             M::::::M    M:::::M    M::::::Me::::::eeeeeeeeeee  
  R::::R     R:::::Ra::::a    a:::::a  l::::l l::::l       y:::::::::y 2:::::2             M::::::M     MMMMM     M::::::Me:::::::e           
RR:::::R     R:::::Ra::::a    a:::::a l::::::l::::::l       y:::::::y  2:::::2       222222M::::::M               M::::::Me::::::::e          
R::::::R     R:::::Ra:::::aaaa::::::a l::::::l::::::l        y:::::y   2::::::2222222:::::2M::::::M               M::::::M e::::::::eeeeeeee  
R::::::R     R:::::R a::::::::::aa:::al::::::l::::::l       y:::::y    2::::::::::::::::::2M::::::M               M::::::M  ee:::::::::::::e  
RRRRRRRR     RRRRRRR  aaaaaaaaaa  aaaalllllllllllllll      y:::::y     22222222222222222222MMMMMMMM               MMMMMMMM    eeeeeeeeeeeeee  
                                                          y:::::y                                                                             
                                                         y:::::y                                                                              
                                                        y:::::y                                                                               
                                                       y:::::y                                                                                
                                                      yyyyyyy                                                                                 
                                                                                                                                                                                                                                  
--]]
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Rally2Me Configuration
local Rally2Me = {
    Enabled = false,
    FPSBoost = {
        Enabled = false,
        Level = 1, -- 1 = Basic, 2 = Advanced, 3 = Extreme
        Settings = {
            Decals = true,
            Particles = true,
            Shadows = true,
            Water = true,
            Lighting = true,
            Materials = true
        }
    },
    Teleporter = {
        Enabled = false,
        CurrentLocationIndex = 1,
        Locations = {
            Vector3.new(349.801025, 198.626328, 1460.024292),
            Vector3.new(387.053894, 198.033615, 1432.853271)
        }
    },
    ScriptLoader = {
        Enabled = false
    },
    UI = {
        Visible = false,
        Position = UDim2.new(0.5, -150, 0.5, -200),
        Size = UDim2.new(0, 300, 0, 500) -- Increased height for new features
    }
}

-- Define user lists (from original Aspect file)
local PremiumUsers = {2240908381, 1282607174}
local NormalUsers = {2240916508, 2240989223, 2240971826}

-- Function to check if a value exists in a table
local function TableContains(tbl, value)
    for _, v in ipairs(tbl) do
        if v == value then
            return true
        end
    end
    return false
end

-- Check user ID and load appropriate script
local function CheckUserAndLoadScript()
    local userId = LocalPlayer.UserId

    if TableContains(PremiumUsers, userId) then
        -- Premium user - load premium script
        loadstring(
            game:HttpGet(
                "https://raw.githubusercontent.com/DEVIL-Script/DEVIL-Hub/refs/heads/main/Saber-Simulator-Auto-Save-Prem",
                true
            )
        )()
        print("Rally2Me: Premium script loaded for user:", userId)
        return true
    elseif TableContains(NormalUsers, userId) then
        -- Normal user - load normal script
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEVIL-Script/DEVIL-Hub/main/DEVIL-Hub-Main", true))()
        print("Rally2Me: Normal script loaded for user:", userId)
        return true
    else
        -- User not in list, kick them
        LocalPlayer:Kick("You are not authorized to use this script.")
        print("Rally2Me: Kicked unauthorized user:", userId)
        return false
    end
end

-- Teleporter Functions
local function TeleportToLocation()
    if not Rally2Me.Teleporter.Enabled then
        return
    end
    HumanoidRootPart.CFrame = CFrame.new(Rally2Me.Teleporter.Locations[Rally2Me.Teleporter.CurrentLocationIndex])
    print("Rally2Me: Teleported to location", Rally2Me.Teleporter.CurrentLocationIndex)
end

local function SwitchTeleportLocation()
    Rally2Me.Teleporter.CurrentLocationIndex = Rally2Me.Teleporter.CurrentLocationIndex % #Rally2Me.Teleporter.Locations + 1
    print("Rally2Me: Switched to teleport location", Rally2Me.Teleporter.CurrentLocationIndex)
end

-- Enhanced FPS Booster Functions
local function ApplyBasicFPSBoost()
    local w = game.Workspace
    local l = game.Lighting
    local t = w.Terrain
    
    -- Basic optimizations
    sethiddenproperty(l, "Technology", 2)
    sethiddenproperty(t, "Decoration", false)
    
    -- Terrain optimizations
    t.WaterWaveSize = 0
    t.WaterWaveSpeed = 0
    t.WaterReflectance = 0
    t.WaterTransparency = 0
    
    -- Lighting optimizations
    l.GlobalShadows = 0
    l.FogEnd = 9e9
    l.Brightness = 0
    
    -- Rendering quality
    settings().Rendering.QualityLevel = "Level01"
    
    print("Rally2Me: Basic FPS boost applied")
end

local function ApplyAdvancedFPSBoost()
    local w = game.Workspace
    local l = game.Lighting
    
    -- Advanced optimizations
    for i, v in pairs(w:GetDescendants()) do
        if v:IsA("BasePart") and not v:IsA("MeshPart") then
            v.Material = "Plastic"
            v.Reflectance = 0
        elseif (v:IsA("Decal") or v:IsA("Texture")) and Rally2Me.FPSBoost.Settings.Decals then
            v.Transparency = 1
        elseif v:IsA("ParticleEmitter") or v:IsA("Trail") and Rally2Me.FPSBoost.Settings.Particles then
            v.Lifetime = NumberRange.new(0)
        elseif v:IsA("Explosion") then
            v.BlastPressure = 1
            v.BlastRadius = 1
        elseif v:IsA("Fire") or v:IsA("SpotLight") or v:IsA("Smoke") or v:IsA("Sparkles") then
            v.Enabled = false
        elseif v:IsA("MeshPart") and Rally2Me.FPSBoost.Settings.Materials then
            v.Material = "Plastic"
            v.Reflectance = 0
            v.TextureID = 10385902758728957
        elseif v:IsA("SpecialMesh") and Rally2Me.FPSBoost.Settings.Materials then
            v.TextureId = 0
        elseif v:IsA("ShirtGraphic") and Rally2Me.FPSBoost.Settings.Materials then
            v.Graphic = 0
        elseif (v:IsA("Shirt") or v:IsA("Pants")) and Rally2Me.FPSBoost.Settings.Materials then
            v[v.ClassName.."Template"] = 0
        end
    end
    
    -- Lighting effects
    for i = 1, #l:GetChildren() do
        local e = l:GetChildren()[i]
        if e:IsA("BlurEffect") or e:IsA("SunRaysEffect") or e:IsA("ColorCorrectionEffect") or e:IsA("BloomEffect") or e:IsA("DepthOfFieldEffect") then
            e.Enabled = false
        end
    end
    
    print("Rally2Me: Advanced FPS boost applied")
end

local function ApplyExtremeFPSBoost()
    -- Extreme optimizations
    local w = game.Workspace
    local l = game.Lighting
    
    -- Disable all unnecessary rendering
    settings().Rendering.QualityLevel = "Level01"
    settings().Physics.PhysicsSendMethod = Enum.PhysicsSendMethod.TopNErrors
    settings().Physics.ExperimentalDevEnabled = false
    
    -- Disable all lighting effects
    for _, effect in pairs(l:GetChildren()) do
        if effect:IsA("PostEffect") then
            effect.Enabled = false
        end
    end
    
    -- Optimize workspace
    for _, obj in pairs(w:GetDescendants()) do
        if obj:IsA("BasePart") then
            obj.CanCollide = false
            obj.Anchored = true
        elseif obj:IsA("Sound") then
            obj.Volume = 0
        end
    end
    
    print("Rally2Me: Extreme FPS boost applied")
end

local function ApplyFPSBoost()
    if not Rally2Me.FPSBoost.Enabled then return end
    
    if Rally2Me.FPSBoost.Level == 1 then
        ApplyBasicFPSBoost()
    elseif Rally2Me.FPSBoost.Level == 2 then
        ApplyBasicFPSBoost()
        ApplyAdvancedFPSBoost()
    elseif Rally2Me.FPSBoost.Level == 3 then
        ApplyBasicFPSBoost()
        ApplyAdvancedFPSBoost()
        ApplyExtremeFPSBoost()
    end
end

-- Continuous FPS optimization
local function FPSOptimizationLoop()
    while true do
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
        wait(5) -- Reapply every 5 seconds
    end
end

-- Teleporter loop
local function TeleporterLoop()
    while true do
        if Rally2Me.Teleporter.Enabled then
            TeleportToLocation()
            wait(1)
        else
            wait(0.1)
        end
    end
end

-- Create Rally2Me UI
local function CreateRally2MeUI()
    -- Main GUI
    local Rally2MeGUI = Instance.new("ScreenGui")
    Rally2MeGUI.Name = "Rally2MeGUI"
    Rally2MeGUI.Parent = CoreGui
    Rally2MeGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Main Frame
    local MainFrame = Instance.new("Frame")
    MainFrame.Name = "MainFrame"
    MainFrame.Size = Rally2Me.UI.Size
    MainFrame.Position = Rally2Me.UI.Position
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    MainFrame.BorderSizePixel = 0
    MainFrame.Active = true
    MainFrame.Parent = Rally2MeGUI
    MainFrame.Visible = Rally2Me.UI.Visible
    
    -- Make the frame draggable
    local UserInputService = game:GetService("UserInputService")
    local dragging
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    MainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
    
    -- Main Frame Corner
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 10)
    MainCorner.Parent = MainFrame
    
    -- Title Bar
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.Position = UDim2.new(0, 0, 0, 0)
    TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainFrame
    
    local TitleBarCorner = Instance.new("UICorner")
    TitleBarCorner.CornerRadius = UDim.new(0, 10)
    TitleBarCorner.Parent = TitleBar
    
    -- Title
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(0, 200, 0, 40)
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Rally2Me"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 18
    Title.Parent = TitleBar
    
    -- Close Button
    local CloseButton = Instance.new("TextButton")
    CloseButton.Name = "CloseButton"
    CloseButton.Size = UDim2.new(0, 30, 0, 30)
    CloseButton.Position = UDim2.new(1, -35, 0, 5)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    CloseButton.BorderSizePixel = 0
    CloseButton.Text = "X"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 16
    CloseButton.Parent = TitleBar
    
    local CloseButtonCorner = Instance.new("UICorner")
    CloseButtonCorner.CornerRadius = UDim.new(0, 6)
    CloseButtonCorner.Parent = CloseButton
    
    -- Content Frame
    local ContentFrame = Instance.new("Frame")
    ContentFrame.Name = "ContentFrame"
    ContentFrame.Size = UDim2.new(1, -20, 1, -60)
    ContentFrame.Position = UDim2.new(0, 10, 0, 50)
    ContentFrame.BackgroundTransparency = 1
    ContentFrame.Parent = MainFrame
    
    -- FPS Boost Section
    local FPSBoostLabel = Instance.new("TextLabel")
    FPSBoostLabel.Name = "FPSBoostLabel"
    FPSBoostLabel.Size = UDim2.new(1, 0, 0, 25)
    FPSBoostLabel.Position = UDim2.new(0, 0, 0, 0)
    FPSBoostLabel.BackgroundTransparency = 1
    FPSBoostLabel.Text = "FPS Booster"
    FPSBoostLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    FPSBoostLabel.Font = Enum.Font.GothamBold
    FPSBoostLabel.TextSize = 16
    FPSBoostLabel.Parent = ContentFrame
    
    -- FPS Boost Toggle
    local FPSBoostToggle = Instance.new("TextButton")
    FPSBoostToggle.Name = "FPSBoostToggle"
    FPSBoostToggle.Size = UDim2.new(0.8, 0, 0, 35)
    FPSBoostToggle.Position = UDim2.new(0.1, 0, 0, 30)
    FPSBoostToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    FPSBoostToggle.BorderSizePixel = 0
    FPSBoostToggle.Text = "FPS Boost: OFF"
    FPSBoostToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    FPSBoostToggle.Font = Enum.Font.Gotham
    FPSBoostToggle.TextSize = 14
    FPSBoostToggle.Parent = ContentFrame
    
    local FPSBoostToggleCorner = Instance.new("UICorner")
    FPSBoostToggleCorner.CornerRadius = UDim.new(0, 8)
    FPSBoostToggleCorner.Parent = FPSBoostToggle
    
    -- FPS Boost Level Label
    local FPSLevelLabel = Instance.new("TextLabel")
    FPSLevelLabel.Name = "FPSLevelLabel"
    FPSLevelLabel.Size = UDim2.new(1, 0, 0, 20)
    FPSLevelLabel.Position = UDim2.new(0, 0, 0, 75)
    FPSLevelLabel.BackgroundTransparency = 1
    FPSLevelLabel.Text = "Boost Level: Basic"
    FPSLevelLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    FPSLevelLabel.Font = Enum.Font.Gotham
    FPSLevelLabel.TextSize = 12
    FPSLevelLabel.Parent = ContentFrame
    
    -- FPS Boost Level Buttons
    local LevelBasicButton = Instance.new("TextButton")
    LevelBasicButton.Name = "LevelBasicButton"
    LevelBasicButton.Size = UDim2.new(0.25, -5, 0, 25)
    LevelBasicButton.Position = UDim2.new(0, 0, 0, 100)
    LevelBasicButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    LevelBasicButton.BorderSizePixel = 0
    LevelBasicButton.Text = "Basic"
    LevelBasicButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    LevelBasicButton.Font = Enum.Font.Gotham
    LevelBasicButton.TextSize = 12
    LevelBasicButton.Parent = ContentFrame
    
    local LevelBasicCorner = Instance.new("UICorner")
    LevelBasicCorner.CornerRadius = UDim.new(0, 6)
    LevelBasicCorner.Parent = LevelBasicButton
    
    local LevelAdvancedButton = Instance.new("TextButton")
    LevelAdvancedButton.Name = "LevelAdvancedButton"
    LevelAdvancedButton.Size = UDim2.new(0.25, -5, 0, 25)
    LevelAdvancedButton.Position = UDim2.new(0.26, 0, 0, 100)
    LevelAdvancedButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    LevelAdvancedButton.BorderSizePixel = 0
    LevelAdvancedButton.Text = "Advanced"
    LevelAdvancedButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    LevelAdvancedButton.Font = Enum.Font.Gotham
    LevelAdvancedButton.TextSize = 12
    LevelAdvancedButton.Parent = ContentFrame
    
    local LevelAdvancedCorner = Instance.new("UICorner")
    LevelAdvancedCorner.CornerRadius = UDim.new(0, 6)
    LevelAdvancedCorner.Parent = LevelAdvancedButton
    
    local LevelExtremeButton = Instance.new("TextButton")
    LevelExtremeButton.Name = "LevelExtremeButton"
    LevelExtremeButton.Size = UDim2.new(0.25, -5, 0, 25)
    LevelExtremeButton.Position = UDim2.new(0.52, 0, 0, 100)
    LevelExtremeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    LevelExtremeButton.BorderSizePixel = 0
    LevelExtremeButton.Text = "Extreme"
    LevelExtremeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    LevelExtremeButton.Font = Enum.Font.Gotham
    LevelExtremeButton.TextSize = 12
    LevelExtremeButton.Parent = ContentFrame
    
    local LevelExtremeCorner = Instance.new("UICorner")
    LevelExtremeCorner.CornerRadius = UDim.new(0, 6)
    LevelExtremeCorner.Parent = LevelExtremeButton
    
    -- Settings Section
    local SettingsLabel = Instance.new("TextLabel")
    SettingsLabel.Name = "SettingsLabel"
    SettingsLabel.Size = UDim2.new(1, 0, 0, 25)
    SettingsLabel.Position = UDim2.new(0, 0, 0, 140)
    SettingsLabel.BackgroundTransparency = 1
    SettingsLabel.Text = "FPS Settings"
    SettingsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    SettingsLabel.Font = Enum.Font.GothamBold
    SettingsLabel.TextSize = 16
    SettingsLabel.Parent = ContentFrame
    
    -- Settings Toggles
    local DecalsToggle = Instance.new("TextButton")
    DecalsToggle.Name = "DecalsToggle"
    DecalsToggle.Size = UDim2.new(0.8, 0, 0, 25)
    DecalsToggle.Position = UDim2.new(0.1, 0, 0, 170)
    DecalsToggle.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    DecalsToggle.BorderSizePixel = 0
    DecalsToggle.Text = "Decals: ON"
    DecalsToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    DecalsToggle.Font = Enum.Font.Gotham
    DecalsToggle.TextSize = 12
    DecalsToggle.Parent = ContentFrame
    
    local DecalsToggleCorner = Instance.new("UICorner")
    DecalsToggleCorner.CornerRadius = UDim.new(0, 6)
    DecalsToggleCorner.Parent = DecalsToggle
    
    local ParticlesToggle = Instance.new("TextButton")
    ParticlesToggle.Name = "ParticlesToggle"
    ParticlesToggle.Size = UDim2.new(0.8, 0, 0, 25)
    ParticlesToggle.Position = UDim2.new(0.1, 0, 0, 200)
    ParticlesToggle.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    ParticlesToggle.BorderSizePixel = 0
    ParticlesToggle.Text = "Particles: ON"
    ParticlesToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    ParticlesToggle.Font = Enum.Font.Gotham
    ParticlesToggle.TextSize = 12
    ParticlesToggle.Parent = ContentFrame
    
    local ParticlesToggleCorner = Instance.new("UICorner")
    ParticlesToggleCorner.CornerRadius = UDim.new(0, 6)
    ParticlesToggleCorner.Parent = ParticlesToggle
    
    local MaterialsToggle = Instance.new("TextButton")
    MaterialsToggle.Name = "MaterialsToggle"
    MaterialsToggle.Size = UDim2.new(0.8, 0, 0, 25)
    MaterialsToggle.Position = UDim2.new(0.1, 0, 0, 230)
    MaterialsToggle.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    MaterialsToggle.BorderSizePixel = 0
    MaterialsToggle.Text = "Materials: ON"
    MaterialsToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    MaterialsToggle.Font = Enum.Font.Gotham
    MaterialsToggle.TextSize = 12
    MaterialsToggle.Parent = ContentFrame
    
    local MaterialsToggleCorner = Instance.new("UICorner")
    MaterialsToggleCorner.CornerRadius = UDim.new(0, 6)
    MaterialsToggleCorner.Parent = MaterialsToggle
    
    -- Teleporter Section
    local TeleporterLabel = Instance.new("TextLabel")
    TeleporterLabel.Name = "TeleporterLabel"
    TeleporterLabel.Size = UDim2.new(1, 0, 0, 25)
    TeleporterLabel.Position = UDim2.new(0, 0, 0, 270)
    TeleporterLabel.BackgroundTransparency = 1
    TeleporterLabel.Text = "Teleporter"
    TeleporterLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TeleporterLabel.Font = Enum.Font.GothamBold
    TeleporterLabel.TextSize = 16
    TeleporterLabel.Parent = ContentFrame
    
    -- Teleporter Toggle
    local TeleporterToggle = Instance.new("TextButton")
    TeleporterToggle.Name = "TeleporterToggle"
    TeleporterToggle.Size = UDim2.new(0.8, 0, 0, 35)
    TeleporterToggle.Position = UDim2.new(0.1, 0, 0, 300)
    TeleporterToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    TeleporterToggle.BorderSizePixel = 0
    TeleporterToggle.Text = "Teleporter: OFF"
    TeleporterToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    TeleporterToggle.Font = Enum.Font.Gotham
    TeleporterToggle.TextSize = 14
    TeleporterToggle.Parent = ContentFrame
    
    local TeleporterToggleCorner = Instance.new("UICorner")
    TeleporterToggleCorner.CornerRadius = UDim.new(0, 8)
    TeleporterToggleCorner.Parent = TeleporterToggle
    
    -- Switch Location Button
    local SwitchLocationButton = Instance.new("TextButton")
    SwitchLocationButton.Name = "SwitchLocationButton"
    SwitchLocationButton.Size = UDim2.new(0.8, 0, 0, 25)
    SwitchLocationButton.Position = UDim2.new(0.1, 0, 0, 340)
    SwitchLocationButton.BackgroundColor3 = Color3.fromRGB(80, 60, 140)
    SwitchLocationButton.BorderSizePixel = 0
    SwitchLocationButton.Text = "Switch Location (1)"
    SwitchLocationButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    SwitchLocationButton.Font = Enum.Font.Gotham
    SwitchLocationButton.TextSize = 12
    SwitchLocationButton.Parent = ContentFrame
    
    local SwitchLocationCorner = Instance.new("UICorner")
    SwitchLocationCorner.CornerRadius = UDim.new(0, 6)
    SwitchLocationCorner.Parent = SwitchLocationButton
    
    -- Script Loader Section
    local ScriptLoaderLabel = Instance.new("TextLabel")
    ScriptLoaderLabel.Name = "ScriptLoaderLabel"
    ScriptLoaderLabel.Size = UDim2.new(1, 0, 0, 25)
    ScriptLoaderLabel.Position = UDim2.new(0, 0, 0, 380)
    ScriptLoaderLabel.BackgroundTransparency = 1
    ScriptLoaderLabel.Text = "Script Loader"
    ScriptLoaderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ScriptLoaderLabel.Font = Enum.Font.GothamBold
    ScriptLoaderLabel.TextSize = 16
    ScriptLoaderLabel.Parent = ContentFrame
    
    -- Load Script Button
    local LoadScriptButton = Instance.new("TextButton")
    LoadScriptButton.Name = "LoadScriptButton"
    LoadScriptButton.Size = UDim2.new(0.8, 0, 0, 35)
    LoadScriptButton.Position = UDim2.new(0.1, 0, 0, 410)
    LoadScriptButton.BackgroundColor3 = Color3.fromRGB(80, 60, 140)
    LoadScriptButton.BorderSizePixel = 0
    LoadScriptButton.Text = "Load Script"
    LoadScriptButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    LoadScriptButton.Font = Enum.Font.Gotham
    LoadScriptButton.TextSize = 14
    LoadScriptButton.Parent = ContentFrame
    
    local LoadScriptCorner = Instance.new("UICorner")
    LoadScriptCorner.CornerRadius = UDim.new(0, 8)
    LoadScriptCorner.Parent = LoadScriptButton
    
    -- Status Section
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Name = "StatusLabel"
    StatusLabel.Size = UDim2.new(1, 0, 0, 25)
    StatusLabel.Position = UDim2.new(0, 0, 0, 460)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "Status: Ready"
    StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.TextSize = 14
    StatusLabel.Parent = ContentFrame
    
    -- Button Event Handlers
    CloseButton.MouseButton1Click:Connect(function()
        Rally2Me.UI.Visible = false
        MainFrame.Visible = false
    end)
    
    FPSBoostToggle.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Enabled = not Rally2Me.FPSBoost.Enabled
        if Rally2Me.FPSBoost.Enabled then
            FPSBoostToggle.Text = "FPS Boost: ON"
            FPSBoostToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            StatusLabel.Text = "Status: FPS Boost Active"
            StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
            ApplyFPSBoost()
        else
            FPSBoostToggle.Text = "FPS Boost: OFF"
            FPSBoostToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            StatusLabel.Text = "Status: FPS Boost Disabled"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        end
    end)
    
    LevelBasicButton.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Level = 1
        FPSLevelLabel.Text = "Boost Level: Basic"
        LevelBasicButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
        LevelAdvancedButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        LevelExtremeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    LevelAdvancedButton.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Level = 2
        FPSLevelLabel.Text = "Boost Level: Advanced"
        LevelBasicButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        LevelAdvancedButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
        LevelExtremeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    LevelExtremeButton.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Level = 3
        FPSLevelLabel.Text = "Boost Level: Extreme"
        LevelBasicButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        LevelAdvancedButton.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
        LevelExtremeButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    DecalsToggle.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Settings.Decals = not Rally2Me.FPSBoost.Settings.Decals
        DecalsToggle.Text = "Decals: " .. (Rally2Me.FPSBoost.Settings.Decals and "ON" or "OFF")
        DecalsToggle.BackgroundColor3 = Rally2Me.FPSBoost.Settings.Decals and Color3.fromRGB(0, 120, 215) or Color3.fromRGB(50, 50, 60)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    ParticlesToggle.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Settings.Particles = not Rally2Me.FPSBoost.Settings.Particles
        ParticlesToggle.Text = "Particles: " .. (Rally2Me.FPSBoost.Settings.Particles and "ON" or "OFF")
        ParticlesToggle.BackgroundColor3 = Rally2Me.FPSBoost.Settings.Particles and Color3.fromRGB(0, 120, 215) or Color3.fromRGB(50, 50, 60)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    MaterialsToggle.MouseButton1Click:Connect(function()
        Rally2Me.FPSBoost.Settings.Materials = not Rally2Me.FPSBoost.Settings.Materials
        MaterialsToggle.Text = "Materials: " .. (Rally2Me.FPSBoost.Settings.Materials and "ON" or "OFF")
        MaterialsToggle.BackgroundColor3 = Rally2Me.FPSBoost.Settings.Materials and Color3.fromRGB(0, 120, 215) or Color3.fromRGB(50, 50, 60)
        if Rally2Me.FPSBoost.Enabled then
            ApplyFPSBoost()
        end
    end)
    
    -- Teleporter Event Handlers
    TeleporterToggle.MouseButton1Click:Connect(function()
        Rally2Me.Teleporter.Enabled = not Rally2Me.Teleporter.Enabled
        if Rally2Me.Teleporter.Enabled then
            TeleporterToggle.Text = "Teleporter: ON"
            TeleporterToggle.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            StatusLabel.Text = "Status: Teleporter Active"
            StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        else
            TeleporterToggle.Text = "Teleporter: OFF"
            TeleporterToggle.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
            StatusLabel.Text = "Status: Teleporter Disabled"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
        end
    end)
    
    SwitchLocationButton.MouseButton1Click:Connect(function()
        SwitchTeleportLocation()
        SwitchLocationButton.Text = "Switch Location (" .. Rally2Me.Teleporter.CurrentLocationIndex .. ")"
    end)
    
    LoadScriptButton.MouseButton1Click:Connect(function()
        local success = CheckUserAndLoadScript()
        if success then
            LoadScriptButton.Text = "Script Loaded"
            LoadScriptButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            StatusLabel.Text = "Status: Script Loaded Successfully"
            StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        else
            LoadScriptButton.Text = "Not Authorized"
            LoadScriptButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
            StatusLabel.Text = "Status: Not Authorized"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        end
    end)
    
    return Rally2MeGUI, MainFrame
end

-- Create Toggle Button
local function CreateToggleButton()
    local ToggleGUI = Instance.new("ScreenGui")
    ToggleGUI.Name = "Rally2MeToggle"
    ToggleGUI.Parent = CoreGui
    ToggleGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Name = "ToggleButton"
    ToggleButton.Size = UDim2.new(0, 50, 0, 50)
    ToggleButton.Position = UDim2.new(0, 10, 0.5, -25)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = "R2M"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.TextSize = 16
    ToggleButton.Parent = ToggleGUI
    
    -- Make the toggle button draggable
    local toggleDragging
    local toggleDragInput
    local toggleDragStart
    local toggleStartPos
    
    local function updateToggle(input)
        local delta = input.Position - toggleDragStart
        ToggleButton.Position = UDim2.new(toggleStartPos.X.Scale, toggleStartPos.X.Offset + delta.X, toggleStartPos.Y.Scale, toggleStartPos.Y.Offset + delta.Y)
    end
    
    ToggleButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            toggleDragging = true
            toggleDragStart = input.Position
            toggleStartPos = ToggleButton.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    toggleDragging = false
                end
            end)
        end
    end)
    
    ToggleButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            toggleDragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == toggleDragInput and toggleDragging then
            updateToggle(input)
        end
    end)
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 8)
    ToggleCorner.Parent = ToggleButton
    
    return ToggleGUI, ToggleButton
end

-- Initialize Rally2Me
local function InitializeRally2Me()
    local Rally2MeGUI, MainFrame = CreateRally2MeUI()
    local ToggleGUI, ToggleButton = CreateToggleButton()
    
    -- Toggle button functionality
    ToggleButton.MouseButton1Click:Connect(function()
        Rally2Me.UI.Visible = not Rally2Me.UI.Visible
        MainFrame.Visible = Rally2Me.UI.Visible
    end)
    
    -- Start FPS optimization loop
    coroutine.wrap(FPSOptimizationLoop)()
    
    -- Start teleporter loop
    coroutine.wrap(TeleporterLoop)()
    
    print("Rally2Me UI Library loaded successfully!")
    print("Press the R2M button to open/close the UI")
    print("FPS Booster, Teleporter, and Script Loader are ready to use")
    
    return Rally2MeGUI, ToggleGUI
end

-- Start Rally2Me
local Rally2MeGUI, ToggleGUI = InitializeRally2Me()

-- Anti-AFK System (Enhanced)
local AntiAFKEnabled = true
local AntiAFKInterval = 15

local function PerformAntiAFKAction()
    if not AntiAFKEnabled or not LocalPlayer or not LocalPlayer.Character then
        return
    end
    
    local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
    if humanoid then
        -- Simulate movement
        local randomDirection = Vector3.new(math.random(-1, 1), 0, math.random(-1, 1))
        humanoid:Move(randomDirection)
        
        -- Simulate camera movement
        local camera = workspace.CurrentCamera
        if camera then
            local currentCFrame = camera.CFrame
            local randomRotation = CFrame.Angles(math.rad(math.random(-2, 2)), math.rad(math.random(-2, 2)), 0)
            camera.CFrame = currentCFrame * randomRotation
        end
    end
end

local function AntiAFKLoop()
    while true do
        if AntiAFKEnabled and LocalPlayer and LocalPlayer.Character then
            PerformAntiAFKAction()
        end
        wait(AntiAFKInterval)
    end
end

-- Start Anti-AFK
coroutine.wrap(AntiAFKLoop)()

-- Input handling for Anti-AFK toggle
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F then
        AntiAFKEnabled = not AntiAFKEnabled
        local status = AntiAFKEnabled and "ENABLED" or "DISABLED"
        print("Rally2Me Anti-AFK:", status)
    end
end)

print("Rally2Me Anti-AFK: Press F to toggle. Current status:", AntiAFKEnabled and "ENABLED" or "DISABLED")
